{% extends "layout/base.html" %}
{% load thumbnail %}
{% load truncate_filters %}
{% block content %}
	
	<script type="text/javascript">
		$(document).ready(function () {
   			$(".vote").click(function (e) {
     			adresse=($(this).attr("href")); // on recuperer l' adresse du lien
     			spanNote = $(this).parent().children().first();
				$.ajax({ // ajax
					url: adresse, // url de la page à charger
					cache: false, // pas de mise en cache
					success:function(html){ // si la requête est un succès 
						var retour = html.split(':');
						spanNote.empty();
						spanNote.append(retour[0]);
						if (retour[1].indexOf('done')==-1) alert(retour[1]);
					},
					error:function(XMLHttpRequest, textStatus, errorThrows){ // erreur durant la requete
						alert("error");
					}
				});
     			return false;
   			});
 		});
	</script>
<div id="challenge">	
	<div id="profile">
		<div id="top_profile">
			
		</div>
		<div id="profile_left">
			
			<!-- l'url de l'img -->
			<div id="challenge_avatar_back">
				<div id="challenge_avatar">
				<!--<img src="{% thumbnail defi.photo 145x145 crop %}" alt="{{defi.titre}}" />-->
					<img src="{{MEDIA_URL}}images/defi_test.png" />
				</div>
			</div>
			
			<h3 class="profile_pseudo">{{ defi.titre }}</h3>

				<p><span class="bold">Category :</span> {{ category }}</p>
				<p><span class="bold">Description :</span> {{ defi.description }}</p>
				<p><span class="bold">Difficulty :</span> {{ difficulty }}</p>		
				<p><span class="bold">Beginning :</span> {{ defi.debut }}</p>	

				{% if end == 0 %}
				<p>Time Left: {{ defi.timeleft }}</p>
				<p><a class="formLB" href="/challenges/create_reponse/{{defi.id}}/" title="{{reponse.id}}">Take up the challenge</a></p>

				{% else %}
					<p>Challenge over</p>
				{% endif %}		
				<p><a class="formLB" href="/challenges/create_reponse/{{defi.id}}/" title="{{reponse.id}}">Take up the challenge</a></p>
				
				<div class="fb-like" data-href="http://justdothat.alwaysdata.net/challenges/display_challenge/{{defi.id}}/" data-send="true" data-layout="button_count" data-width="450" data-show-faces="true" data-font="trebuchet ms"></div>
				
				{% if createur %}
				<p>
					<a class="edit_profile_link" href="/challenges/modif_challenge/{{defi.id}}/" title="{{defi.titre}}">> Modify</a><br/> 
					<a class="delete_profile_link" href="/challenges/delete_challenge/{{defi.id}}/confirm/" title="{{defi.titre}}">> Delete</a> 
				</p>
				{% endif %}
				
		
			</ul>
			
			<h3>Challengers</h3>	
			<ul>
				{% for user in users %}
					<li class="user">
						<p> <a href='#'>{{ user}}</a> </p>
					</li>
					<br />
				{% endfor %}
			</ul>
			
		
			
		</div>
		<div id="profile_center">
			<div class="challenges_headline">
		    	<h2>SUBMITTED</h2>
		    </div>
		 	
		 	{% for reponse in reponses %}
			<!--<a href="/challenges/display_challenge/{{defi.id}}/" title="{{defi.titre}}">{{ defi.titre }}</a> -->
			
		 	
		 	<div id="challenge_submitted_back">
   
			    <div id="challenge_submitted">
					<img src="{% thumbnail reponse.photo 145x145 crop %}" />
					
					<div class="one_challenge">
						{% for user in users %}
							{% if reponse.utilisateur == user %}
						<h3>{{ user}}</h3><span class="date_reponse">{{ reponse.date_reponse }} </span>
							{% endif %}
						{% endfor %}
						<p>{{ reponse.message }} </p>
						<p>note : <span class="note">{{ reponse.note }}</span>  
						{% if user.is_authenticated %}
							<a href="http://localhost:8000/reponses/notation_ajax/{{ user.id }}/1/{{ reponse.id }}/" class="vote">+</a> 
							<a href="http://localhost:8000/reponses/notation_ajax/{{ user.id }}/0/{{ reponse.id }}/" class="vote">-</a>
						{% endif %}
						</p>
						{% if reponse.utilisateur == request.user %}
						<p>
							<a class="formLB" href="/challenges/modif_reponse/{{reponse.id}}/{{defi.id}}/" title="{{reponse.id}}" class="delete_profile_link">> Modify</a> 
							<a href="/challenges/delete_reponse/{{reponse.id}}/" title="{{reponse.id}}" class="edit_profile_link">> Delete</a> 
						</p>
						{% endif %}
					</div>
				</div>
			</div>
		    
			
			
			
		
		<br />
			
			{% load comments %}

			{% render_comment_form for reponse %}

			{% render_comment_list for reponse %}
			
  {% endfor %}	
		</div>
		<div id="profile_right">
		{% for d in defiList %}
			{{ d.titre|truncate_chars:22 }}
			
			{{ d.debut }}
			{{ d.createur.username}}
			{{ d.timeleft }}
			<!--<img src="{% thumbnail d.photo 145x145 crop %}" alt="{{d.titre}}" />-->
			{{ d.difficulte }}
			{{ d.categorie }}
			{{ d.nbreleve}}
			
			<br />
			<br />
		{% endfor %}
			<p><a href="/challenges/list_challenges/" title="Voir tous les challenges"> Retour aux challenges </a></p>	
		</div>
		<div id="bottom_profile">
			
		</div>
		
	</div>
	
	
	
	
  
</div>  	
{% endblock content %}

